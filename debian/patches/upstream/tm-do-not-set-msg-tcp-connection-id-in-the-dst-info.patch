From: Daniel-Constantin Mierla <miconda@gmail.com>
Date: Mon, 30 Mar 2020 10:11:54 +0200
Subject: [PATCH] tm: do not set msg tcp connection id in the dst info

(cherry picked from commit 974c50aea6b581b5f8545f3d710e98b53d44bd67)
---
 src/modules/tm/t_funcs.c | 1 -
 src/modules/tm/t_fwd.c   | 2 --
 2 files changed, 3 deletions(-)

diff --git a/src/modules/tm/t_funcs.c b/src/modules/tm/t_funcs.c
index 0e484d9..ee06bed 100644
--- a/src/modules/tm/t_funcs.c
+++ b/src/modules/tm/t_funcs.c
@@ -285,7 +285,6 @@ int t_relay_to( struct sip_msg  *p_msg , struct proxy_l *proxy, int proto,
 	if ( p_msg->REQ_METHOD==METHOD_ACK) {
 		LM_DBG("forwarding ACK statelessly\n");
 		init_dest_info(&dst);
-		dst.id = p_msg->otcpid;
 		if (proxy==0) {
 			dst.proto=proto;
 			if (get_uri_send_info(GET_NEXT_HOP(p_msg), &host, &port,
diff --git a/src/modules/tm/t_fwd.c b/src/modules/tm/t_fwd.c
index 81a0f20..83f22eb 100644
--- a/src/modules/tm/t_fwd.c
+++ b/src/modules/tm/t_fwd.c
@@ -1673,7 +1673,6 @@ int t_forward_nonack( struct cell *t, struct sip_msg* p_msg,
 		if (t->flags & T_CANCELED) goto canceled;
 		if (branch_ret>=0) {
 			added_branches |= 1<<branch_ret;
-			t->uac[branch_ret].request.dst.id = p_msg->otcpid;
 		} else {
 			lowest_ret=MIN_int(lowest_ret, branch_ret);
 		}
@@ -1700,7 +1699,6 @@ int t_forward_nonack( struct cell *t, struct sip_msg* p_msg,
 		 * branch result */
 		if (branch_ret>=0) {
 			added_branches |= 1<<branch_ret;
-			t->uac[branch_ret].request.dst.id = obranch.otcpid;
 		} else {
 			lowest_ret=MIN_int(lowest_ret, branch_ret);
 		}
